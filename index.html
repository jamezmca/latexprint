<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>latexprint.io</title>

  <!-- KaTeX -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>

  <style>
    :root {
      --bg: white;
      --fg: #030615;
      --accent: #030615;
      --border: #e5e7eb;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--fg);
    }

    .app-shell {
      max-width: 900px;
      margin: 0 auto;
      padding: 1.5rem 1rem 3rem;
    }

    header {
      margin-bottom: 1rem;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    @media (max-width: 648px) {
      .header-top {
        justify-content: center;
        margin-bottom: 0.5rem;
      }
      .controls-desktop {
        display: none !important;
      }
    }

    @media (min-width: 649px) {
      .controls-mobile {
        display: none !important;
      }
    }

    .logo {
      font-weight: 700;
      font-size: 1.1rem;
    }

    .controls {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .controls-mobile {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 0.5rem;
      width: 100%;
    }

    button {
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 0.4rem 0.9rem;
      font-size: 0.9rem;
      cursor: pointer;
      background: white;
    }

    button.primary {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    button:active {
      transform: translateY(1px);
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 1rem;
    }

    .panel {
      background: white;
      border-radius: 0.75rem;
      border: 1px solid var(--border);
      padding: 1rem;
    }

    .panel h2 {
      margin: 0 0 0.5rem;
      font-size: 1rem;
    }

    textarea {
      width: 100%;
      min-height: 220px;
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 0.9rem;
      padding: 0.75rem;
      border-radius: 0.5rem;
      border: 1px solid var(--border);
      resize: vertical;
    }

    .hint {
      font-size: 0.8rem;
      color: #6b7280;
      margin-top: 0.25rem;
    }

    .output-wrapper {
      padding: 0.5rem 1.5rem;
      min-height: 400px;
    }

    .brand-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
    }

    .brand-title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .brand-subtitle {
      font-size: 0.9rem;
      color: #6b7280;
    }

    .rendered-output {
      font-size: 1rem;
      line-height: 1.5;
    }

    ol { padding-left: 1.4rem; }
    li + li { margin-top: 0.25rem; }

    .rendered-output h1 {
      margin: 0;
      margin-bottom: 0.25rem;
      font-size: 1.3rem;
      font-weight: 600;
    }

    .print-branding {
      font-size: 0.75rem;
      color: #6b7280;
      margin-bottom: 0.5rem;
      display: none;
    }

    @media print {
      .print-branding {
        display: block;
      }
    }

    .collapsible-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
    }

    .collapsible-content {
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .collapsible-content.collapsed {
      max-height: 0;
    }

    .collapsible-content.expanded {
      max-height: 500px;
    }

    .toggle-icon {
      font-size: 0.8rem;
      transition: transform 0.3s ease;
    }

    .toggle-icon.rotated {
      transform: rotate(180deg);
    }

    @media print {
      body { background: white; }

      .app-shell {
        max-width: 100%;
        margin: 0;
        padding: 0.5rem 1rem 0;
      }

      header,
      .panel.input-panel,
      .panel.example-panel { display: none !important; }

      .panel.output-panel {
        border: none;
        padding: 0;
      }

      .output-wrapper { padding: 0; }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="header-top">
        <div class="logo">latexprint.io</div>
        <div class="controls controls-desktop">
          <button class="primary" id="renderBtn">Render</button>
          <button type="button" onclick="location.reload()">Clear / Refresh</button>
          <button type="button" onclick="window.print()">Print</button>
        </div>
      </div>
      <div class="controls-mobile">
        <button class="primary" id="renderBtn2">Render</button>
        <button type="button" onclick="location.reload()">Clear / Refresh</button>
        <button type="button" onclick="window.print()">Print</button>
      </div>
    </header>

    <main>
      <section class="panel input-panel">
        <h2>3. Paste your LaTeX document</h2>
        <textarea id="latexInput" placeholder="Paste a full LaTeX article here, e.g. with \documentclass, \begin{document}, \begin{enumerate}, \item ..."></textarea>
        <div class="hint">
          This strips the preamble, converts <code>enumerate</code> to an ordered list, and renders maths inside
          <code>\( ... \)</code>, <code>\[ ... \]</code>, or <code>$$...$$</code>.
        </div>
      </section>

      <section class="panel example-panel">
        <div class="collapsible-header" onclick="toggleCollapsible()">
          <h2>2. Example ChatGPT Prompt</h2>
          <span class="toggle-icon" id="toggleIcon">▼</span>
        </div>
        <div class="collapsible-content collapsed" id="promptContent">
          <textarea readonly style="min-height: 120px; background: #f8f9fa; cursor: text;">Generate [20] mathematics questions about [expanding quadratics]. Format them as a LaTeX document with:
- A centered title: [Expanding Factorised Quadratics]
- Each question as an \item in an enumerate environment
- [2] line breaks between every question for spacing
- Use proper LaTeX math formatting with \( \) for inline expressions
- Include a mix of difficulty levels
- Start with \documentclass[12pt]{article} and proper document structure</textarea>
          <div class="hint">
            Copy this prompt template to ChatGPT, replace the bracketed placeholders with your specific requirements, then paste the generated LaTeX above.
          </div>
        </div>
      </section>

      <section class="panel output-panel">
        <div class="output-wrapper">
          <div class="print-branding">latexprint.io</div>
          <div id="output" class="rendered-output">
            <!-- Rendered content appears here -->
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    function processLatex(input) {
      // Grab body between \begin{document} and \end{document}
      const match = input.match(/\\begin{document}([\s\S]*?)\\end{document}/)
      let body = match ? match[1] : input

      // Trim leading/trailing whitespace
      body = body.trim()

      // Convert \begin{center}...\end{center} into a nice H1
      body = body.replace(/\\begin{center}([\s\S]*?)\\end{center}/, (_, inner) => {
        // crude cleanup for typical title pattern
        let text = inner
          .replace(/\\LARGE/g, '')
          .replace(/\\Large/g, '')
          .replace(/\\large/g, '')
          .replace(/\\textbf{([^}]*)}/g, '$1')
          .replace(/[{}]/g, '')
          .replace(/\\\\/g, '')
          .replace(/\[\d+pt\]/g, '')
          .trim()
        return `<h1 style="text-align: center;">${text}</h1>`
      })

      // Convert LaTeX spacing commands to line breaks
      body = body.replace(/\\\\\[\d+pt\]/g, '<br>')
      body = body.replace(/\\\\/g, '<br>')

      // Convert enumerate environment to HTML ordered list
      body = body.replace(/\\begin{enumerate}/g, '<ol>')
                 .replace(/\\end{enumerate}/g, '</ol>')
                 .replace(/\\item/g, '<li>')

      // Clean up excessive whitespace and convert paragraph breaks
      body = body.replace(/\n\s*\n+/g, '\n\n')
      body = body.replace(/\n\n/g, '<br><br>')
      
      // Clean up any trailing breaks after h1
      body = body.replace(/(<h1[^>]*>[^<]*<\/h1>)(<br><br>)+/g, '$1')
      body = body.replace(/(<h1[^>]*>[^<]*<\/h1>)(<br>)+/g, '$1')

      return body
    }

    function renderLatex() {
      const input = document.getElementById('latexInput').value
      const output = document.getElementById('output')

      const html = processLatex(input)
      output.innerHTML = html

      // Ask KaTeX to render the maths
      renderMathInElement(output, {
        delimiters: [
          { left: '$$', right: '$$', display: true },
          { left: '\\[', right: '\\]', display: true },
          { left: '\\(', right: '\\)', display: false }
        ],
        throwOnError: false
      })
    }

    document.getElementById('renderBtn').addEventListener('click', renderLatex)
    document.getElementById('renderBtn2').addEventListener('click', renderLatex)

    // Collapsible functionality
    function toggleCollapsible() {
      const content = document.getElementById('promptContent')
      const icon = document.getElementById('toggleIcon')
      
      if (content.classList.contains('collapsed')) {
        content.classList.remove('collapsed')
        content.classList.add('expanded')
        icon.textContent = '▲'
        icon.classList.add('rotated')
      } else {
        content.classList.remove('expanded')
        content.classList.add('collapsed')
        icon.textContent = '▼'
        icon.classList.remove('rotated')
      }
    }

    // date stamp in header
    const dateStamp = document.getElementById('dateStamp')
    const today = new Date()
    dateStamp.textContent = today.toLocaleDateString(undefined, {
      year: 'numeric',
      month: 'short',
      day: 'numeric'
    })
  </script>
</body>
</html>
